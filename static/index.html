<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Test Agent – Python</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: #0b0b0b;
            color: #ffffff;
            min-height: 100vh;
            padding: 32px;
        }

        .container {
            max-width: 900px;
            margin: auto;
        }

        .header {
            border-bottom: 1px solid #222;
            padding-bottom: 16px;
            margin-bottom: 28px;
        }

        h1 {
            font-size: 26px;
            font-weight: 600;
        }

        .note {
            margin-top: 8px;
            color: #9ca3af;
            font-size: 14px;
        }

        .input-section {
            margin-bottom: 28px;
        }

        .example-item {
            background: #111;
            border: 1px solid #222;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            font-family: monospace;
            font-size: 14px;
            color: #e5e7eb;
        }

        .example-item:hover {
            background: #1a1a1a;
        }

        input {
            width: 100%;
            padding: 14px;
            background: #111;
            border: 1px solid #333;
            color: #fff;
            margin: 14px 0;
            font-size: 15px;
        }

        input::placeholder {
            color: #6b7280;
        }

        button {
            background: #ffffff;
            color: #000;
            border: none;
            padding: 12px 22px;
            font-size: 15px;
            cursor: pointer;
            font-weight: 500;
        }

        button:hover {
            opacity: 0.9;
        }

        .results {
            margin-top: 28px;
        }

        .status-passed {
            color: #22c55e;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .status-failed {
            color: #ef4444;
            font-weight: 600;
            margin-bottom: 10px;
        }

        pre {
            background: #111;
            border: 1px solid #222;
            padding: 14px;
            margin-top: 10px;
            overflow-x: auto;
            font-size: 13px;
            color: #d1d5db;
        }

        h3 {
            margin-top: 18px;
            font-size: 15px;
            font-weight: 500;
        }
    </style>
</head>

<body>
<div class="container">

    <div class="header">
        <h1>AI Test Agent – Python</h1>
        <div class="note">
            ⚠️ Playwright runs in a separate browser window.  
            Watch your desktop after clicking <b>Run Test</b>.
        </div>
    </div>

    <div class="input-section">

        <!-- LOGIN -->
        <div class="example-item"
             onclick="document.getElementById('instruction').value=
`open browser go to http://127.0.0.1:5500/login.html
type admin into #username
type admin123 into #password
click #loginBtn`">
▶ Local Login (Visible)
        </div>

        <!-- GOOGLE SEARCH -->
        <div class="example-item"
             onclick="document.getElementById('instruction').value=
`open browser go to https://www.google.com
search python playwright tutorial`">
▶ Google Search – Playwright
        </div>

        <!-- YOUTUBE SEARCH + PLAY -->
        <div class="example-item"
             onclick="document.getElementById('instruction').value=
`open browser go to https://www.youtube.com
search dooron doon song
wait 3000
click first video`">
▶ YouTube – Search & Play
        </div>

        <!-- AMAZON SEARCH -->
        <div class="example-item"
             onclick="document.getElementById('instruction').value=
`open browser go to https://www.amazon.in
search wireless mouse`">
▶ Amazon – Product Search
        </div>

        <input id="instruction"
               placeholder="Paste instruction here…"
               onkeypress="if(event.key==='Enter') runTest()"/>

        <button onclick="runTest()">Run Test</button>
    </div>

    <div class="results" id="results"></div>

</div>

<script>
async function runTest() {
    const instruction = document.getElementById('instruction').value.trim();
    if (!instruction) return alert('Enter instruction');

    document.getElementById('results').innerHTML =
        '<p style="color:#9ca3af">Running test… watch the browser window</p>';

    try {
        const res = await fetch('/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: instruction })
        });

        const data = await res.json();
        const passed = data.execution?.passed;

        document.getElementById('results').innerHTML = `
            <div class="${passed ? 'status-passed' : 'status-failed'}">
                ${passed ? 'PASS' : 'FAIL'}
            </div>

            <h3>Browser</h3>
            <p>Open: ${data.browser_state?.browser_open ? 'Yes' : 'No'}</p>
            <p>URL: ${data.browser_state?.current_url || 'None'}</p>

            <h3>Generated Python Code</h3>
            <pre>${data.generated_code}</pre>

            <h3>Execution Output</h3>
            <pre>${data.execution?.output || 'Live output shown in terminal'}</pre>
        `;
    } catch (e) {
        alert('Error: ' + e.message);
    }
}
</script>

</body>
</html>
